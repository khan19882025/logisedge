{% extends 'base.html' %}
{% load static %}

{% block title %}Preview Settings - PDF Preview Tool{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-cog text-primary"></i>
                    Preview Settings
                </h1>
                <p class="page-subtitle">Customize your PDF preview experience and preferences</p>
            </div>
        </div>
    </div>

    <!-- Preview Settings Form -->
    <div class="row">
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-cog"></i> Preview Preferences
                    </h6>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.default_zoom.id_for_label }}" class="form-label">
                                        <strong>Default Zoom Level</strong>
                                    </label>
                                    {{ form.default_zoom }}
                                    <small class="form-text text-muted">Zoom level when opening documents (50% - 200%)</small>
                                    {% if form.default_zoom.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.default_zoom.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.default_page.id_for_label }}" class="form-label">
                                        <strong>Default Page</strong>
                                    </label>
                                    {{ form.default_page }}
                                    <small class="form-text text-muted">Page to show when opening documents</small>
                                    {% if form.default_page.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.default_page.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.show_thumbnails.id_for_label }}" class="form-label">
                                        <strong>Show Thumbnails</strong>
                                    </label>
                                    <div class="form-check">
                                        {{ form.show_thumbnails }}
                                        <label class="form-check-label" for="{{ form.show_thumbnails.id_for_label }}">
                                            Display page thumbnails in sidebar
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.show_search.id_for_label }}" class="form-label">
                                        <strong>Show Search</strong>
                                    </label>
                                    <div class="form-check">
                                        {{ form.show_search }}
                                        <label class="form-check-label" for="{{ form.show_search.id_for_label }}">
                                            Display search functionality
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.auto_save_preferences.id_for_label }}" class="form-label">
                                        <strong>Auto-save Preferences</strong>
                                    </label>
                                    <div class="form-check">
                                        {{ form.auto_save_preferences }}
                                        <label class="form-check-label" for="{{ form.auto_save_preferences.id_for_label }}">
                                            Automatically save user preferences
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.remember_last_position.id_for_label }}" class="form-label">
                                        <strong>Remember Position</strong>
                                    </label>
                                    <div class="form-check">
                                        {{ form.remember_last_position }}
                                        <label class="form-check-label" for="{{ form.remember_last_position.id_for_label }}">
                                            Remember last viewed page and zoom
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-3">
                            <label for="{{ form.theme.id_for_label }}" class="form-label">
                                <strong>Preview Theme</strong>
                            </label>
                            {{ form.theme }}
                            <small class="form-text text-muted">Choose your preferred preview interface theme</small>
                            {% if form.theme.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.theme.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-group mb-3">
                            <label for="{{ form.language.id_for_label }}" class="form-label">
                                <strong>Interface Language</strong>
                            </label>
                            {{ form.language }}
                            <small class="form-text text-muted">Language for the preview interface</small>
                            {% if form.language.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.language.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                            <a href="{% url 'pdf_preview_tool:dashboard' %}" class="btn btn-secondary btn-lg">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Sidebar -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-info-circle"></i> Current Settings
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Default Zoom:</strong> 
                        <span class="badge bg-primary">{{ preview_settings.default_zoom|default:"100%" }}</span>
                    </div>
                    <div class="mb-3">
                        <strong>Default Page:</strong> 
                        <span class="badge bg-info">{{ preview_settings.default_page|default:"1" }}</span>
                    </div>
                    <div class="mb-3">
                        <strong>Thumbnails:</strong> 
                        <span class="badge bg-{% if preview_settings.show_thumbnails %}success{% else %}secondary{% endif %}">
                            {{ preview_settings.show_thumbnails|yesno:"Enabled,Disabled" }}
                        </span>
                    </div>
                    <div class="mb-3">
                        <strong>Search:</strong> 
                        <span class="badge bg-{% if preview_settings.show_search %}success{% else %}secondary{% endif %}">
                            {{ preview_settings.show_search|yesno:"Enabled,Disabled" }}
                        </span>
                    </div>
                    <div class="mb-3">
                        <strong>Theme:</strong> 
                        <span class="badge bg-warning">{{ preview_settings.theme|default:"Default" }}</span>
                    </div>
                </div>
            </div>

            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-question-circle"></i> Help & Tips
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6><i class="fas fa-lightbulb text-warning"></i> Zoom Tips</h6>
                        <ul class="list-unstyled small">
                            <li>• 100% = Actual size</li>
                            <li>• 50% = Half size (good for overview)</li>
                            <li>• 200% = Double size (good for details)</li>
                        </ul>
                    </div>
                    <div class="mb-3">
                        <h6><i class="fas fa-cog text-info"></i> Performance</h6>
                        <ul class="list-unstyled small">
                            <li>• Disable thumbnails for faster loading</li>
                            <li>• Lower zoom levels use less memory</li>
                            <li>• Auto-save preferences for convenience</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-tools"></i> Settings Actions
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <a href="{% url 'pdf_preview_tool:dashboard' %}" class="btn btn-primary btn-block">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <a href="{% url 'pdf_preview_tool:document_list' %}" class="btn btn-info btn-block">
                                <i class="fas fa-list"></i>
                                Documents
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <a href="{% url 'pdf_preview_tool:document_upload' %}" class="btn btn-success btn-block">
                                <i class="fas fa-upload"></i>
                                Upload
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <button type="button" class="btn btn-warning btn-block" onclick="resetToDefaults()">
                                <i class="fas fa-undo"></i>
                                Reset Defaults
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        });
    }
    
    // Auto-resize textarea fields
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    });
    
    // Enhanced form controls
    const zoomInput = document.getElementById('{{ form.default_zoom.id_for_label }}');
    if (zoomInput) {
        zoomInput.addEventListener('input', function() {
            const value = parseInt(this.value);
            if (value < 50) this.value = 50;
            if (value > 200) this.value = 200;
        });
    }
    
    const pageInput = document.getElementById('{{ form.default_page.id_for_label }}');
    if (pageInput) {
        pageInput.addEventListener('input', function() {
            const value = parseInt(this.value);
            if (value < 1) this.value = 1;
        });
    }
});

// Reset to default settings
function resetToDefaults() {
    if (confirm('Are you sure you want to reset all settings to default values? This action cannot be undone.')) {
        // Reset form fields to default values
        const form = document.querySelector('form');
        if (form) {
            const zoomInput = document.getElementById('{{ form.default_zoom.id_for_label }}');
            if (zoomInput) zoomInput.value = '100';
            
            const pageInput = document.getElementById('{{ form.default_page.id_for_label }}');
            if (pageInput) pageInput.value = '1';
            
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            const themeSelect = document.getElementById('{{ form.theme.id_for_label }}');
            if (themeSelect) themeSelect.selectedIndex = 0;
            
            const languageSelect = document.getElementById('{{ form.language.id_for_label }}');
            if (languageSelect) languageSelect.selectedIndex = 0;
            
            // Show success message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-check-circle"></i>
                Settings have been reset to default values.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            form.parentNode.insertBefore(alertDiv, form);
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    }
}
</script>
{% endblock %}
