{% extends 'base.html' %}
{% load static %}

{% block title %}{{ candidate.full_name }} - Candidate Details{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/recruitment/recruitment.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'recruitment:dashboard' %}">Recruitment</a></li>
            <li class="breadcrumb-item"><a href="{% url 'recruitment:candidate_list' %}">Candidates</a></li>
            <li class="breadcrumb-item active">{{ candidate.full_name }}</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="page-title">
                    <i class="fas fa-user text-primary"></i>
                    {{ candidate.full_name }}
                </h2>
                <p class="text-muted">{{ candidate.current_position|default:"Candidate" }} at {{ candidate.current_company|default:"Not specified" }}</p>
            </div>
            <div class="col-auto">
                <div class="btn-group" role="group">
                    <a href="{% url 'recruitment:candidate_update' candidate.id %}" class="btn btn-outline-secondary">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <a href="{% url 'recruitment:application_create' %}?candidate={{ candidate.id }}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create Application
                    </a>
                    <button type="button" class="btn btn-outline-success dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="{% url 'recruitment:interview_create' %}?candidate={{ candidate.id }}">
                                <i class="fas fa-calendar me-2"></i>Schedule Interview
                            </a>
                        </li>
                        {% if candidate.resume %}
                        <li>
                            <a class="dropdown-item" href="{{ candidate.resume.url }}" target="_blank">
                                <i class="fas fa-download me-2"></i>Download Resume
                            </a>
                        </li>
                        {% endif %}
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="{% url 'recruitment:candidate_delete' candidate.id %}"
                               onclick="return confirm('Are you sure you want to delete this candidate?')">
                                <i class="fas fa-trash me-2"></i>Delete Candidate
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Candidate Information -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-user-circle text-primary"></i>
                        Personal Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <div class="avatar-lg mx-auto mb-3">
                            <div class="avatar-title bg-light rounded-circle">
                                <i class="fas fa-user fa-2x text-primary"></i>
                            </div>
                        </div>
                        <h5 class="mb-1">{{ candidate.full_name }}</h5>
                        <p class="text-muted mb-0">{{ candidate.current_position|default:"Not specified" }}</p>
                    </div>

                    <div class="candidate-info">
                        <div class="info-item">
                            <label class="text-muted">Email:</label>
                            <div class="fw-medium">{{ candidate.email }}</div>
                        </div>
                        <div class="info-item">
                            <label class="text-muted">Phone:</label>
                            <div class="fw-medium">{{ candidate.phone }}</div>
                        </div>
                        {% if candidate.date_of_birth %}
                        <div class="info-item">
                            <label class="text-muted">Date of Birth:</label>
                            <div class="fw-medium">{{ candidate.date_of_birth|date:"M d, Y" }}</div>
                        </div>
                        {% endif %}
                        {% if candidate.gender %}
                        <div class="info-item">
                            <label class="text-muted">Gender:</label>
                            <div class="fw-medium">{{ candidate.get_gender_display }}</div>
                        </div>
                        {% endif %}
                        {% if candidate.address %}
                        <div class="info-item">
                            <label class="text-muted">Address:</label>
                            <div class="fw-medium">{{ candidate.address }}</div>
                        </div>
                        {% endif %}
                        {% if candidate.city or candidate.country %}
                        <div class="info-item">
                            <label class="text-muted">Location:</label>
                            <div class="fw-medium">{{ candidate.city }}{% if candidate.city and candidate.country %}, {% endif %}{{ candidate.country }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Professional Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-briefcase text-success"></i>
                        Professional Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="candidate-info">
                        {% if candidate.current_company %}
                        <div class="info-item">
                            <label class="text-muted">Current Company:</label>
                            <div class="fw-medium">{{ candidate.current_company }}</div>
                        </div>
                        {% endif %}
                        {% if candidate.years_of_experience %}
                        <div class="info-item">
                            <label class="text-muted">Experience:</label>
                            <div class="fw-medium">{{ candidate.years_of_experience }} years</div>
                        </div>
                        {% endif %}
                        {% if candidate.expected_salary %}
                        <div class="info-item">
                            <label class="text-muted">Expected Salary:</label>
                            <div class="fw-medium">${{ candidate.expected_salary|floatformat:0 }}</div>
                        </div>
                        {% endif %}
                        {% if candidate.availability %}
                        <div class="info-item">
                            <label class="text-muted">Availability:</label>
                            <div class="fw-medium">{{ candidate.get_availability_display }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Status & Source -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tags text-info"></i>
                        Status & Source
                    </h5>
                </div>
                <div class="card-body">
                    <div class="candidate-info">
                        <div class="info-item">
                            <label class="text-muted">Status:</label>
                            <div>
                                {% if candidate.status == 'active' %}
                                    <span class="badge bg-primary">Active</span>
                                {% elif candidate.status == 'shortlisted' %}
                                    <span class="badge bg-warning">Shortlisted</span>
                                {% elif candidate.status == 'interviewed' %}
                                    <span class="badge bg-info">Interviewed</span>
                                {% elif candidate.status == 'offered' %}
                                    <span class="badge bg-success">Offered</span>
                                {% elif candidate.status == 'hired' %}
                                    <span class="badge bg-success"><i class="fas fa-check"></i> Hired</span>
                                {% elif candidate.status == 'rejected' %}
                                    <span class="badge bg-danger">Rejected</span>
                                {% elif candidate.status == 'withdrawn' %}
                                    <span class="badge bg-secondary">Withdrawn</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="text-muted">Source:</label>
                            <div>
                                {% if candidate.source == 'job_portal' %}
                                    <span class="badge bg-primary">Job Portal</span>
                                {% elif candidate.source == 'referral' %}
                                    <span class="badge bg-success">Referral</span>
                                {% elif candidate.source == 'linkedin' %}
                                    <span class="badge bg-info">LinkedIn</span>
                                {% elif candidate.source == 'walk_in' %}
                                    <span class="badge bg-warning">Walk-in</span>
                                {% elif candidate.source == 'campus' %}
                                    <span class="badge bg-secondary">Campus</span>
                                {% else %}
                                    <span class="badge bg-light text-dark">Other</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="text-muted">Added Date:</label>
                            <div class="fw-medium">{{ candidate.created_at|date:"M d, Y" }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-8">
            <!-- Skills & Summary -->
            {% if candidate.skills or candidate.summary %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-star text-warning"></i>
                        Skills & Summary
                    </h5>
                </div>
                <div class="card-body">
                    {% if candidate.skills %}
                    <div class="mb-3">
                        <label class="text-muted fw-medium">Skills:</label>
                        <div class="skills-container">
                            {% for skill in candidate.skills_list %}
                            <span class="badge bg-light text-dark me-1 mb-1">{{ skill }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% if candidate.summary %}
                    <div>
                        <label class="text-muted fw-medium">Professional Summary:</label>
                        <p class="mb-0">{{ candidate.summary }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Documents -->
            {% if candidate.resume or candidate.cover_letter %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-file-alt text-primary"></i>
                        Documents
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% if candidate.resume %}
                        <div class="col-md-6">
                            <div class="document-item">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-file-pdf text-danger fa-2x me-3"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">Resume/CV</h6>
                                        <small class="text-muted">{{ candidate.resume.name|slice:"7:" }}</small>
                                    </div>
                                    <a href="{{ candidate.resume.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-download"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% if candidate.cover_letter %}
                        <div class="col-md-6">
                            <div class="document-item">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-file-alt text-primary fa-2x me-3"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">Cover Letter</h6>
                                        <small class="text-muted">{{ candidate.cover_letter.name|slice:"7:" }}</small>
                                    </div>
                                    <a href="{{ candidate.cover_letter.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-download"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Applications -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-clipboard-list text-info"></i>
                        Applications
                    </h5>
                    <a href="{% url 'recruitment:application_create' %}?candidate={{ candidate.id }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus"></i> New Application
                    </a>
                </div>
                <div class="card-body">
                    {% if candidate.applications.all %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Position</th>
                                    <th>Status</th>
                                    <th>Applied Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for application in candidate.applications.all %}
                                <tr>
                                    <td>
                                        <div>
                                            <div class="fw-medium">{{ application.job_requisition.title }}</div>
                                            <small class="text-muted">{{ application.job_requisition.department.name }}</small>
                                        </div>
                                    </td>
                                    <td>
                                        {% if application.status == 'applied' %}
                                            <span class="badge bg-primary">Applied</span>
                                        {% elif application.status == 'shortlisted' %}
                                            <span class="badge bg-warning">Shortlisted</span>
                                        {% elif application.status == 'interviewed' %}
                                            <span class="badge bg-info">Interviewed</span>
                                        {% elif application.status == 'offered' %}
                                            <span class="badge bg-success">Offered</span>
                                        {% elif application.status == 'hired' %}
                                            <span class="badge bg-success"><i class="fas fa-check"></i> Hired</span>
                                        {% elif application.status == 'rejected' %}
                                            <span class="badge bg-danger">Rejected</span>
                                        {% elif application.status == 'withdrawn' %}
                                            <span class="badge bg-secondary">Withdrawn</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ application.applied_date|date:"M d, Y" }}</small>
                                    </td>
                                    <td>
                                        <a href="{% url 'recruitment:application_detail' application.id %}" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-3">
                        <i class="fas fa-clipboard-list fa-2x text-muted mb-2"></i>
                        <p class="text-muted mb-0">No applications found for this candidate</p>
                        <a href="{% url 'recruitment:application_create' %}?candidate={{ candidate.id }}" class="btn btn-sm btn-primary mt-2">
                            <i class="fas fa-plus"></i> Create First Application
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Interviews -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-calendar-alt text-success"></i>
                        Interviews
                    </h5>
                    <a href="{% url 'recruitment:interview_create' %}?candidate={{ candidate.id }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus"></i> Schedule Interview
                    </a>
                </div>
                <div class="card-body">
                    {% if candidate.interviews.all %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Position</th>
                                    <th>Type</th>
                                    <th>Date & Time</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for interview in candidate.interviews.all %}
                                <tr>
                                    <td>
                                        <div class="fw-medium">{{ interview.application.job_requisition.title }}</div>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ interview.get_interview_type_display }}</span>
                                    </td>
                                    <td>
                                        <div>
                                            <div class="fw-medium">{{ interview.scheduled_date|date:"M d, Y" }}</div>
                                            <small class="text-muted">{{ interview.scheduled_time|time:"H:i" }}</small>
                                        </div>
                                    </td>
                                    <td>
                                        {% if interview.status == 'scheduled' %}
                                            <span class="badge bg-primary">Scheduled</span>
                                        {% elif interview.status == 'completed' %}
                                            <span class="badge bg-success">Completed</span>
                                        {% elif interview.status == 'cancelled' %}
                                            <span class="badge bg-danger">Cancelled</span>
                                        {% elif interview.status == 'rescheduled' %}
                                            <span class="badge bg-warning">Rescheduled</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'recruitment:interview_detail' interview.id %}" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-3">
                        <i class="fas fa-calendar-alt fa-2x text-muted mb-2"></i>
                        <p class="text-muted mb-0">No interviews scheduled for this candidate</p>
                        <a href="{% url 'recruitment:interview_create' %}?candidate={{ candidate.id }}" class="btn btn-sm btn-primary mt-2">
                            <i class="fas fa-plus"></i> Schedule First Interview
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Notes -->
            {% if candidate.notes %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-sticky-note text-warning"></i>
                        Internal Notes
                    </h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ candidate.notes }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/recruitment/recruitment.js' %}"></script>
{% endblock %} 