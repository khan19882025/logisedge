{% extends 'dashboard/dashboard.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}{{ title }} - logisEdge{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/salesman/salesman.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-person-badge me-2"></i>{{ title }}
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        <!-- Tab Navigation -->
                        <ul class="nav nav-tabs" id="salesmanTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab" aria-controls="basic" aria-selected="true">
                                    <i class="bi bi-person me-1"></i>Basic Information
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="address-tab" data-bs-toggle="tab" data-bs-target="#address" type="button" role="tab" aria-controls="address" aria-selected="false">
                                    <i class="bi bi-geo-alt me-1"></i>Address Information
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="employment-tab" data-bs-toggle="tab" data-bs-target="#employment" type="button" role="tab" aria-controls="employment" aria-selected="false">
                                    <i class="bi bi-briefcase me-1"></i>Employment Information
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab" aria-controls="performance" aria-selected="false">
                                    <i class="bi bi-graph-up me-1"></i>Performance Information
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="additional-tab" data-bs-toggle="tab" data-bs-target="#additional" type="button" role="tab" aria-controls="additional" aria-selected="false">
                                    <i class="bi bi-info-circle me-1"></i>Additional Information
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="salesmanTabsContent">
                            <!-- Basic Information Tab -->
                            <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                                <div class="p-4">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.salesman_code.id_for_label }}" class="form-label">
                                                Salesman Code <span class="text-danger">*</span>
                                            </label>
                                            {% render_field form.salesman_code class="form-control" %}
                                            {% if form.salesman_code.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.salesman_code.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.first_name.id_for_label }}" class="form-label">
                                                First Name <span class="text-danger">*</span>
                                            </label>
                                            {% render_field form.first_name class="form-control" %}
                                            {% if form.first_name.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.first_name.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.last_name.id_for_label }}" class="form-label">
                                                Last Name <span class="text-danger">*</span>
                                            </label>
                                            {% render_field form.last_name class="form-control" %}
                                            {% if form.last_name.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.last_name.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.gender.id_for_label }}" class="form-label">Gender</label>
                                            {% render_field form.gender class="form-control" %}
                                            {% if form.gender.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.gender.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.email.id_for_label }}" class="form-label">
                                                Email <span class="text-danger">*</span>
                                            </label>
                                            {% render_field form.email class="form-control" %}
                                            {% if form.email.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.email.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.phone.id_for_label }}" class="form-label">
                                                Phone <span class="text-danger">*</span>
                                            </label>
                                            {% render_field form.phone class="form-control" %}
                                            {% if form.phone.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.phone.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">Date of Birth</label>
                                            {% render_field form.date_of_birth class="form-control" %}
                                            {% if form.date_of_birth.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.date_of_birth.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Address Information Tab -->
                            <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                <div class="p-4">
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <label for="{{ form.address.id_for_label }}" class="form-label">Address</label>
                                            {% render_field form.address class="form-control" %}
                                            {% if form.address.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.address.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.city.id_for_label }}" class="form-label">City</label>
                                            {% render_field form.city class="form-control" %}
                                            {% if form.city.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.city.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.state.id_for_label }}" class="form-label">State/Province</label>
                                            {% render_field form.state class="form-control" %}
                                            {% if form.state.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.state.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.country.id_for_label }}" class="form-label">Country</label>
                                            {% render_field form.country class="form-control" %}
                                            {% if form.country.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.country.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.postal_code.id_for_label }}" class="form-label">Postal Code</label>
                                            {% render_field form.postal_code class="form-control" %}
                                            {% if form.postal_code.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.postal_code.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Employment Information Tab -->
                            <div class="tab-pane fade" id="employment" role="tabpanel" aria-labelledby="employment-tab">
                                <div class="p-4">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.hire_date.id_for_label }}" class="form-label">
                                                Hire Date <span class="text-danger">*</span>
                                            </label>
                                            {% render_field form.hire_date class="form-control" %}
                                            {% if form.hire_date.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.hire_date.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.status.id_for_label }}" class="form-label">
                                                Status <span class="text-danger">*</span>
                                            </label>
                                            {% render_field form.status class="form-control" %}
                                            {% if form.status.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.status.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.department.id_for_label }}" class="form-label">Department</label>
                                            {% render_field form.department class="form-control" %}
                                            {% if form.department.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.department.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="{{ form.position.id_for_label }}" class="form-label">Position</label>
                                            {% render_field form.position class="form-control" %}
                                            {% if form.position.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.position.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.manager.id_for_label }}" class="form-label">Manager</label>
                                            {% render_field form.manager class="form-control" %}
                                            {% if form.manager.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.manager.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Information Tab -->
                            <div class="tab-pane fade" id="performance" role="tabpanel" aria-labelledby="performance-tab">
                                <div class="p-4">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.commission_rate.id_for_label }}" class="form-label">Commission Rate (%)</label>
                                            {% render_field form.commission_rate class="form-control" %}
                                            {% if form.commission_rate.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.commission_rate.errors.0 }}
                                                </div>
                                            {% endif %}
                                            <small class="form-text text-muted">Enter commission rate as percentage (e.g., 5.00 for 5%)</small>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.target_amount.id_for_label }}" class="form-label">Monthly Target Amount</label>
                                            {% render_field form.target_amount class="form-control" %}
                                            {% if form.target_amount.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.target_amount.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Information Tab -->
                            <div class="tab-pane fade" id="additional" role="tabpanel" aria-labelledby="additional-tab">
                                <div class="p-4">
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <label for="{{ form.notes.id_for_label }}" class="form-label">Notes</label>
                                            {% render_field form.notes class="form-control" %}
                                            {% if form.notes.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.notes.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{% url 'salesman:salesman_list' %}" class="btn btn-secondary">
                                <i class="bi bi-arrow-left me-1"></i>Back to List
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle me-1"></i>
                                {% if salesman %}Update Salesman{% else %}Create Salesman{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/salesman/salesman.js' %}"></script>
<script>
// Tab validation - show error tabs
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const tabs = document.querySelectorAll('.nav-link');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    // Check for errors and activate corresponding tab
    const errorFields = form.querySelectorAll('.is-invalid');
    if (errorFields.length > 0) {
        errorFields.forEach(function(field) {
            const tabPane = field.closest('.tab-pane');
            if (tabPane) {
                const tabId = tabPane.id;
                const tabButton = document.querySelector(`[data-bs-target="#${tabId}"]`);
                if (tabButton) {
                    // Remove active from all tabs
                    tabs.forEach(tab => {
                        tab.classList.remove('active');
                        tab.setAttribute('aria-selected', 'false');
                    });
                    tabPanes.forEach(pane => {
                        pane.classList.remove('show', 'active');
                    });
                    
                    // Activate the tab with error
                    tabButton.classList.add('active');
                    tabButton.setAttribute('aria-selected', 'true');
                    tabPane.classList.add('show', 'active');
                }
            }
        });
    }
});
</script>
{% endblock %} 