{% extends 'customer/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}{% if customer %}Edit Customer{% else %}Create Customer{% endif %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/customer/customer.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <form method="post" enctype="multipart/form-data" class="customer-form">
                {% csrf_token %}
                
                <div class="customer-form-container">
                    <!-- Form Header -->
                    <div class="form-header">
                        <h2>
                            <i class="bi bi-person-plus me-2"></i>
                            {% if customer %}Edit Customer{% else %}Create New Customer{% endif %}
                        </h2>
                    </div>

                    <!-- Form Body -->
                    <div class="form-body">
                        <!-- Tab Navigation -->
                        <ul class="nav nav-tabs" id="customerTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">
                                    <i class="bi bi-person"></i> Basic Information
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="addresses-tab" data-bs-toggle="tab" data-bs-target="#addresses" type="button" role="tab">
                                    <i class="bi bi-geo-alt"></i> Addresses
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="financial-tab" data-bs-toggle="tab" data-bs-target="#financial" type="button" role="tab">
                                    <i class="bi bi-currency-dollar"></i> Financial
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="portal-tab" data-bs-toggle="tab" data-bs-target="#portal" type="button" role="tab">
                                    <i class="bi bi-lock"></i> Customer Portal
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="customerTabsContent">
                            <!-- Basic Information Tab -->
                            <div class="tab-pane fade show active" id="basic" role="tabpanel">
                                <div class="form-section">
                                    <h6 class="section-title">Customer Details</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.customer_name.id_for_label }}" class="form-label">
                                                    Customer Name <span class="text-danger">*</span>
                                                </label>
                                                {% render_field form.customer_name class="form-control" %}
                                                {% if form.customer_name.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.customer_name.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <!-- Salesman Dropdown -->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.salesman.id_for_label }}" class="form-label">Salesman</label>
                                                {% render_field form.salesman class="form-select" %}
                                                {% if form.salesman.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.salesman.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.contact_person.id_for_label }}" class="form-label">Contact Person</label>
                                                {% render_field form.contact_person class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.email.id_for_label }}" class="form-label">Email Address</label>
                                                {% render_field form.email class="form-control" %}
                                                {% if form.email.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.email.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="{{ form.phone.id_for_label }}" class="form-label">Phone Number</label>
                                                {% render_field form.phone class="form-control" %}
                                                {% if form.phone.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.phone.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="{{ form.mobile.id_for_label }}" class="form-label">Mobile Number</label>
                                                {% render_field form.mobile class="form-control" %}
                                                {% if form.mobile.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.mobile.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="{{ form.fax.id_for_label }}" class="form-label">Fax Number</label>
                                                {% render_field form.fax class="form-control" %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.website.id_for_label }}" class="form-label">Website URL</label>
                                                {% render_field form.website class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.industry.id_for_label }}" class="form-label">Industry</label>
                                                {% render_field form.industry class="form-control" %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.tax_number.id_for_label }}" class="form-label">Tax Number</label>
                                                {% render_field form.tax_number class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.registration_number.id_for_label }}" class="form-label">Registration Number</label>
                                                {% render_field form.registration_number class="form-control" %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Addresses Tab -->
                            <div class="tab-pane fade" id="addresses" role="tabpanel">
                                <div class="form-section">
                                    <h6 class="section-title">Billing Address</h6>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="{{ form.billing_address.id_for_label }}" class="form-label">Billing Address</label>
                                                {% render_field form.billing_address class="form-control" %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.billing_city.id_for_label }}" class="form-label">City</label>
                                                {% render_field form.billing_city class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.billing_state.id_for_label }}" class="form-label">State</label>
                                                {% render_field form.billing_state class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.billing_country.id_for_label }}" class="form-label">Country</label>
                                                {% render_field form.billing_country class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.billing_postal_code.id_for_label }}" class="form-label">Postal Code</label>
                                                {% render_field form.billing_postal_code class="form-control" %}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h6 class="section-title">Shipping Address</h6>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="{{ form.shipping_address.id_for_label }}" class="form-label">Shipping Address</label>
                                                {% render_field form.shipping_address class="form-control" %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.shipping_city.id_for_label }}" class="form-label">City</label>
                                                {% render_field form.shipping_city class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.shipping_state.id_for_label }}" class="form-label">State</label>
                                                {% render_field form.shipping_state class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.shipping_country.id_for_label }}" class="form-label">Country</label>
                                                {% render_field form.shipping_country class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="{{ form.shipping_postal_code.id_for_label }}" class="form-label">Postal Code</label>
                                                {% render_field form.shipping_postal_code class="form-control" %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Financial Tab -->
                            <div class="tab-pane fade" id="financial" role="tabpanel">
                                <div class="form-section">
                                    <h6 class="section-title">Financial Information</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.credit_limit.id_for_label }}" class="form-label">Credit Limit</label>
                                                {% render_field form.credit_limit class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.payment_terms.id_for_label }}" class="form-label">Payment Terms</label>
                                                {% render_field form.payment_terms class="form-control" %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="{{ form.currency.id_for_label }}" class="form-label">Currency</label>
                                                {% render_field form.currency class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="{{ form.tax_rate.id_for_label }}" class="form-label">Tax Rate (%)</label>
                                                {% render_field form.tax_rate class="form-control" %}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="{{ form.discount_percentage.id_for_label }}" class="form-label">Discount (%)</label>
                                                {% render_field form.discount_percentage class="form-control" %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <div class="form-check">
                                                    {% render_field form.tax_exempt class="form-check-input" %}
                                                    <label class="form-check-label" for="{{ form.tax_exempt.id_for_label }}">
                                                        Tax Exempt
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Customer Portal Tab -->
                            <div class="tab-pane fade" id="portal" role="tabpanel">
                                <div class="form-section">
                                    <h6 class="section-title">Portal Configuration</h6>
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>
                                        Customer portal allows customers to view their own stock and account information.
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.portal_username.id_for_label }}" class="form-label">Portal Username</label>
                                                {% render_field form.portal_username class="form-control" %}
                                                {% if form.portal_username.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {{ form.portal_username.errors.0 }}
                                                </div>
                                                {% endif %}
                                                <small class="form-text text-muted">Leave blank to auto-generate</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="{{ form.portal_password.id_for_label }}" class="form-label">Portal Password</label>
                                                <div class="input-group">
                                                    {% render_field form.portal_password class="form-control" %}
                                                    <button class="btn btn-outline-secondary" type="button" id="generatePassword">
                                                        <i class="bi bi-key"></i>
                                                    </button>
                                                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                        <i class="bi bi-eye"></i>
                                                    </button>
                                                </div>
                                                <small class="form-text text-muted">Leave blank to auto-generate</small>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <div class="form-check">
                                                    {% render_field form.portal_active class="form-check-input" %}
                                                    <label class="form-check-label" for="{{ form.portal_active.id_for_label }}">
                                                        Portal Active
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Fields -->
                        <div class="mt-4 pt-4 border-top">
                            <div class="row g-3">
                                <div class="col-md-8">
                                    <div class="row align-items-center">
                                        <div class="col-sm-2">
                                            <label for="{{ form.notes.id_for_label }}" class="form-label mb-0">Notes</label>
                                        </div>
                                        <div class="col-sm-10">
                                            {% render_field form.notes class="form-control" %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="row align-items-center">
                                        <div class="col-sm-4">
                                            <label class="form-label mb-0">Active</label>
                                        </div>
                                        <div class="col-sm-8">
                                            <div class="form-check">
                                                {% render_field form.is_active class="form-check-input" %}
                                                <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                                    Active
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <a href="{% url 'customer:customer_list' %}" class="btn btn-secondary me-2">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg"></i>
                            {% if customer %}Update Customer{% else %}Create Customer{% endif %}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/customer/customer.js' %}"></script>
{% endblock %} 