{% extends 'asset_movement_log/base.html' %}
{% load static %}

{% block title %}
    {% if object %}Edit Asset Movement{% else %}New Asset Movement{% endif %}
{% endblock %}

{% block asset_movement_content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-edit"></i>
                    {% if object %}Edit Asset Movement{% else %}New Asset Movement{% endif %}
                </h3>
                <div class="card-tools">
                    <a href="{% url 'asset_movement_log:movement_list' %}" class="btn btn-secondary btn-sm">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                </div>
            </div>
            <div class="card-body">
                <form method="post" class="form-horizontal">
                    {% csrf_token %}
                    
                    <div class="row">
                        <!-- Basic Information -->
                        <div class="col-md-6">
                            <h5 class="text-primary">
                                <i class="fas fa-info-circle"></i> Basic Information
                            </h5>
                            
                            <div class="form-group">
                                {{ form.asset.label_tag }}
                                {{ form.asset }}
                                {% if form.asset.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.asset.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.movement_type.label_tag }}
                                {{ form.movement_type }}
                                {% if form.movement_type.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.movement_type.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.movement_date.label_tag }}
                                {{ form.movement_date }}
                                {% if form.movement_date.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.movement_date.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.movement_reason.label_tag }}
                                {{ form.movement_reason }}
                                {% if form.movement_reason.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.movement_reason.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Location Information -->
                        <div class="col-md-6">
                            <h5 class="text-primary">
                                <i class="fas fa-map-marker-alt"></i> Location Information
                            </h5>
                            
                            <div class="form-group">
                                {{ form.from_location.label_tag }}
                                {{ form.from_location }}
                                {% if form.from_location.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.from_location.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.to_location.label_tag }}
                                {{ form.to_location }}
                                {% if form.to_location.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.to_location.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.from_user.label_tag }}
                                {{ form.from_user }}
                                {% if form.from_user.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.from_user.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.to_user.label_tag }}
                                {{ form.to_user }}
                                {% if form.to_user.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.to_user.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <!-- Additional Information -->
                        <div class="col-md-12">
                            <h5 class="text-primary">
                                <i class="fas fa-clipboard-list"></i> Additional Information
                            </h5>
                            
                            <div class="form-group">
                                {{ form.reason_description.label_tag }}
                                {{ form.reason_description }}
                                {% if form.reason_description.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.reason_description.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.notes.label_tag }}
                                {{ form.notes }}
                                {% if form.notes.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.notes.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <!-- Duration and Status -->
                        <div class="col-md-6">
                            <h5 class="text-primary">
                                <i class="fas fa-clock"></i> Duration & Status
                            </h5>
                            
                            <div class="form-group">
                                {{ form.estimated_duration.label_tag }}
                                {{ form.estimated_duration }}
                                {% if form.estimated_duration.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.estimated_duration.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                {{ form.actual_return_date.label_tag }}
                                {{ form.actual_return_date }}
                                {% if form.actual_return_date.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.actual_return_date.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h5 class="text-primary">
                                <i class="fas fa-check-circle"></i> Status
                            </h5>
                            
                            <div class="form-group">
                                <div class="custom-control custom-checkbox">
                                    {{ form.is_completed }}
                                    <label class="custom-control-label" for="{{ form.is_completed.id_for_label }}">
                                        {{ form.is_completed.label }}
                                    </label>
                                </div>
                                {% if form.is_completed.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.is_completed.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                <div class="custom-control custom-checkbox">
                                    {{ form.is_approved }}
                                    <label class="custom-control-label" for="{{ form.is_approved.id_for_label }}">
                                        {{ form.is_approved.label }}
                                    </label>
                                </div>
                                {% if form.is_approved.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.is_approved.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    {% if object %}Update Movement{% else %}Create Movement{% endif %}
                                </button>
                                <a href="{% url 'asset_movement_log:movement_list' %}" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Cancel
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Initialize date pickers
    $('input[type="datetime-local"]').datetimepicker({
        format: 'Y-m-d H:i',
        step: 15
    });
    
    // Auto-fill current date if not set
    if (!$('#id_movement_date').val()) {
        var now = new Date();
        var year = now.getFullYear();
        var month = String(now.getMonth() + 1).padStart(2, '0');
        var day = String(now.getDate()).padStart(2, '0');
        var hours = String(now.getHours()).padStart(2, '0');
        var minutes = String(now.getMinutes()).padStart(2, '0');
        $('#id_movement_date').val(year + '-' + month + '-' + day + 'T' + hours + ':' + minutes);
    }
});
</script>
{% endblock %}
