{% extends 'base.html' %}
{% load static %}

{% block title %}Bulk Disposal - Dispose Asset{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dispose_asset/css/dispose_asset.css' %}">
<style>
    .bulk-disposal-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 30px;
        margin-bottom: 30px;
    }
    
    .step-indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
        position: relative;
    }
    
    .step-indicator::before {
        content: '';
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 2px;
        background: #e9ecef;
        z-index: 1;
    }
    
    .step {
        position: relative;
        z-index: 2;
        background: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #e9ecef;
        color: #6c757d;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .step.active {
        border-color: #007bff;
        background: #007bff;
        color: white;
    }
    
    .step.completed {
        border-color: #28a745;
        background: #28a745;
        color: white;
    }
    
    .step-label {
        text-align: center;
        margin-top: 10px;
        font-size: 0.875rem;
        color: #6c757d;
        font-weight: 500;
    }
    
    .step.active .step-label {
        color: #007bff;
    }
    
    .step.completed .step-label {
        color: #28a745;
    }
    
    .step-content {
        display: none;
    }
    
    .step-content.active {
        display: block;
    }
    
    .asset-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .asset-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .asset-card:hover {
        border-color: #007bff;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,123,255,0.1);
    }
    
    .asset-card.selected {
        border-color: #007bff;
        background: #f8f9ff;
    }
    
    .asset-card.selected::before {
        content: 'âœ“';
        position: absolute;
        top: 10px;
        right: 10px;
        background: #007bff;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
    }
    
    .asset-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .asset-code {
        font-weight: 600;
        color: #007bff;
        font-size: 1.1rem;
    }
    
    .asset-status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .status-active {
        background: #d4edda;
        color: #155724;
    }
    
    .status-available {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .asset-details {
        margin-bottom: 15px;
    }
    
    .asset-name {
        font-weight: 600;
        color: #495057;
        margin-bottom: 5px;
    }
    
    .asset-info {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 3px;
    }
    
    .asset-value {
        font-weight: 600;
        color: #28a745;
        font-size: 1.1rem;
    }
    
    .filter-panel {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .filter-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .filter-group {
        flex: 1;
        min-width: 200px;
    }
    
    .filter-group label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
        display: block;
    }
    
    .form-control {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 10px 15px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #007bff, #0056b3);
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,123,255,0.3);
    }
    
    .btn-secondary {
        background: #6c757d;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #28a745, #1e7e34);
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(40,167,69,0.3);
    }
    
    .summary-card {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .summary-row:last-child {
        border-bottom: none;
        margin-bottom: 0;
        font-weight: 600;
        font-size: 1.1rem;
    }
    
    .alert {
        border-radius: 8px;
        border: none;
        padding: 15px 20px;
        margin-bottom: 20px;
    }
    
    .alert-info {
        background: linear-gradient(135deg, #d1ecf1, #bee5eb);
        color: #0c5460;
    }
    
    .loading-spinner {
        display: none;
        text-align: center;
        padding: 40px;
    }
    
    .spinner-border {
        width: 3rem;
        height: 3rem;
    }
    
    .pagination {
        justify-content: center;
        margin-top: 30px;
    }
    
    .page-link {
        border-radius: 8px;
        margin: 0 2px;
        border: 2px solid #e9ecef;
        color: #007bff;
        font-weight: 600;
    }
    
    .page-link:hover {
        background: #007bff;
        border-color: #007bff;
        color: white;
    }
    
    .page-item.active .page-link {
        background: #007bff;
        border-color: #007bff;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    <i class="fas fa-layer-group text-primary me-2"></i>
                    Bulk Asset Disposal
                </h2>
                <a href="{% url 'dispose_asset:disposal_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to List
                </a>
            </div>
            
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
            
            <div class="bulk-disposal-container">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active" data-step="1">
                        <span>1</span>
                        <div class="step-label">Select Assets</div>
                    </div>
                    <div class="step" data-step="2">
                        <span>2</span>
                        <div class="step-label">Disposal Details</div>
                    </div>
                    <div class="step" data-step="3">
                        <span>3</span>
                        <div class="step-label">Review & Submit</div>
                    </div>
                </div>
                
                <!-- Step 1: Asset Selection -->
                <div class="step-content active" id="step-1">
                    <h4 class="mb-4">
                        <i class="fas fa-cubes me-2"></i>Step 1: Select Assets for Disposal
                    </h4>
                    
                    <!-- Filter Panel -->
                    <div class="filter-panel">
                        <h5 class="mb-3">Filter Assets</h5>
                        <form id="asset-filter-form">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label for="search">Search</label>
                                    <input type="text" class="form-control" id="search" name="search" 
                                           placeholder="Search by asset name, code, or serial number...">
                                </div>
                                <div class="filter-group">
                                    <label for="category">Category</label>
                                    <select class="form-control" id="category" name="category">
                                        <option value="">All Categories</option>
                                        {% for category in categories %}
                                            <option value="{{ category.id }}">{{ category.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="location">Location</label>
                                    <select class="form-control" id="location" name="location">
                                        <option value="">All Locations</option>
                                        {% for location in locations %}
                                            <option value="{{ location.id }}">{{ location.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label for="status">Status</label>
                                    <select class="form-control" id="status" name="status">
                                        <option value="">All Statuses</option>
                                        <option value="Active">Active</option>
                                        <option value="Available">Available</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="assigned_to">Assigned To</label>
                                    <select class="form-control" id="assigned_to" name="assigned_to">
                                        <option value="">All Users</option>
                                        {% for user in users %}
                                            <option value="{{ user.id }}">{{ user.get_full_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>&nbsp;</label>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-primary" onclick="filterAssets()">
                                            <i class="fas fa-search me-2"></i>Filter
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="clearFilters()">
                                            <i class="fas fa-times me-2"></i>Clear
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Asset Grid -->
                    <div class="loading-spinner" id="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Loading assets...</p>
                    </div>
                    
                    <div id="asset-grid" class="asset-grid">
                        <!-- Assets will be loaded here via AJAX -->
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Asset pagination" id="pagination">
                        <!-- Pagination will be loaded here -->
                    </nav>
                    
                    <!-- Step Navigation -->
                    <div class="d-flex justify-content-between mt-4">
                        <div></div>
                        <button type="button" class="btn btn-primary" onclick="nextStep()" id="next-step-1">
                            <i class="fas fa-arrow-right me-2"></i>Next: Disposal Details
                        </button>
                    </div>
                </div>
                
                <!-- Step 2: Disposal Details -->
                <div class="step-content" id="step-2">
                    <h4 class="mb-4">
                        <i class="fas fa-edit me-2"></i>Step 2: Disposal Details
                    </h4>
                    
                    <form id="bulk-disposal-form">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Disposal Information</h5>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="disposal_type" class="form-label required-field">Disposal Type</label>
                                                <select class="form-control" id="disposal_type" name="disposal_type" required>
                                                    <option value="">Select disposal type</option>
                                                    {% for disposal_type in disposal_types %}
                                                        <option value="{{ disposal_type.id }}">{{ disposal_type.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="disposal_date" class="form-label required-field">Disposal Date</label>
                                                <input type="date" class="form-control" id="disposal_date" name="disposal_date" required>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="asset_account" class="form-label required-field">Asset Account</label>
                                                <select class="form-control" id="asset_account" name="asset_account" required>
                                                    <option value="">Select asset account</option>
                                                    {% for account in asset_accounts %}
                                                        <option value="{{ account.id }}">{{ account.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="disposal_account" class="form-label required-field">Disposal Account</label>
                                                <select class="form-control" id="disposal_account" name="disposal_account" required>
                                                    <option value="">Select disposal account</option>
                                                    {% for account in disposal_accounts %}
                                                        <option value="{{ account.id }}">{{ account.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="reason" class="form-label required-field">Disposal Reason</label>
                                            <textarea class="form-control" id="reason" name="reason" rows="3" 
                                                      placeholder="Explain the reason for disposing these assets..." required></textarea>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="remarks" class="form-label">Additional Remarks</label>
                                            <textarea class="form-control" id="remarks" name="remarks" rows="3" 
                                                      placeholder="Any additional comments or notes..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="summary-card">
                                    <h5 class="mb-3">Selected Assets Summary</h5>
                                    <div id="selected-assets-summary">
                                        <!-- Summary will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step Navigation -->
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                <i class="fas fa-arrow-left me-2"></i>Previous
                            </button>
                            <button type="button" class="btn btn-primary" onclick="nextStep()" id="next-step-2">
                                <i class="fas fa-arrow-right me-2"></i>Next: Review & Submit
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Step 3: Review & Submit -->
                <div class="step-content" id="step-3">
                    <h4 class="mb-4">
                        <i class="fas fa-check-circle me-2"></i>Step 3: Review & Submit
                    </h4>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Review your bulk disposal request before submitting.</strong>
                        This action will create disposal requests for all selected assets.
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Disposal Request Details</h5>
                                    <div id="review-details">
                                        <!-- Review details will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="summary-card">
                                <h5 class="mb-3">Final Summary</h5>
                                <div id="final-summary">
                                    <!-- Final summary will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step Navigation -->
                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <i class="fas fa-arrow-left me-2"></i>Previous
                        </button>
                        <button type="button" class="btn btn-success" onclick="submitBulkDisposal()" id="submit-bulk">
                            <i class="fas fa-paper-plane me-2"></i>Submit Bulk Disposal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'dispose_asset/js/dispose_asset.js' %}"></script>
<script>
    let selectedAssets = [];
    let currentPage = 1;
    let totalPages = 1;
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        loadAssets();
    });
    
    // Load assets via AJAX
    function loadAssets(page = 1) {
        const loadingSpinner = document.getElementById('loading-spinner');
        const assetGrid = document.getElementById('asset-grid');
        
        loadingSpinner.style.display = 'block';
        assetGrid.style.display = 'none';
        
        const formData = new FormData(document.getElementById('asset-filter-form'));
        formData.append('page', page);
        
        fetch('{% url "dispose_asset:asset_search_ajax" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            loadingSpinner.style.display = 'none';
            assetGrid.style.display = 'grid';
            
            if (data.success) {
                renderAssets(data.assets);
                renderPagination(data.pagination);
                currentPage = data.pagination.current_page;
                totalPages = data.pagination.total_pages;
            } else {
                assetGrid.innerHTML = '<div class="col-12 text-center text-muted">No assets found.</div>';
            }
        })
        .catch(error => {
            loadingSpinner.style.display = 'none';
            assetGrid.style.display = 'grid';
            assetGrid.innerHTML = '<div class="col-12 text-center text-danger">Error loading assets. Please try again.</div>';
            console.error('Error:', error);
        });
    }
    
    // Render assets in grid
    function renderAssets(assets) {
        const assetGrid = document.getElementById('asset-grid');
        assetGrid.innerHTML = '';
        
        assets.forEach(asset => {
            const assetCard = document.createElement('div');
            assetCard.className = 'asset-card';
            assetCard.setAttribute('data-asset-id', asset.id);
            assetCard.onclick = () => toggleAssetSelection(asset.id);
            
            const isSelected = selectedAssets.includes(asset.id);
            if (isSelected) {
                assetCard.classList.add('selected');
            }
            
            assetCard.innerHTML = `
                <div class="asset-header">
                    <div class="asset-code">${asset.asset_code}</div>
                    <span class="asset-status status-${asset.status.toLowerCase()}">${asset.status}</span>
                </div>
                <div class="asset-details">
                    <div class="asset-name">${asset.asset_name}</div>
                    <div class="asset-info">Category: ${asset.category}</div>
                    <div class="asset-info">Location: ${asset.location}</div>
                    <div class="asset-info">Assigned: ${asset.assigned_to || 'Unassigned'}</div>
                    <div class="asset-value">Book Value: $${asset.book_value}</div>
                </div>
            `;
            
            assetGrid.appendChild(assetCard);
        });
    }
    
    // Render pagination
    function renderPagination(pagination) {
        const paginationContainer = document.getElementById('pagination');
        
        if (pagination.total_pages <= 1) {
            paginationContainer.innerHTML = '';
            return;
        }
        
        let paginationHTML = '<ul class="pagination">';
        
        // Previous button
        if (pagination.has_previous) {
            paginationHTML += `<li class="page-item">
                <a class="page-link" href="#" onclick="loadAssets(${pagination.previous_page_number})">Previous</a>
            </li>`;
        }
        
        // Page numbers
        for (let i = 1; i <= pagination.total_pages; i++) {
            const isActive = i === pagination.current_page;
            paginationHTML += `<li class="page-item ${isActive ? 'active' : ''}">
                <a class="page-link" href="#" onclick="loadAssets(${i})">${i}</a>
            </li>`;
        }
        
        // Next button
        if (pagination.has_next) {
            paginationHTML += `<li class="page-item">
                <a class="page-link" href="#" onclick="loadAssets(${pagination.next_page_number})">Next</a>
            </li>`;
        }
        
        paginationHTML += '</ul>';
        paginationContainer.innerHTML = paginationHTML;
    }
    
    // Toggle asset selection
    function toggleAssetSelection(assetId) {
        const index = selectedAssets.indexOf(assetId);
        const assetCard = document.querySelector(`[data-asset-id="${assetId}"]`);
        
        if (index > -1) {
            selectedAssets.splice(index, 1);
            assetCard.classList.remove('selected');
        } else {
            selectedAssets.push(assetId);
            assetCard.classList.add('selected');
        }
        
        updateSelectedAssetsSummary();
    }
    
    // Update selected assets summary
    function updateSelectedAssetsSummary() {
        const summaryContainer = document.getElementById('selected-assets-summary');
        
        if (selectedAssets.length === 0) {
            summaryContainer.innerHTML = '<p class="text-muted">No assets selected</p>';
            return;
        }
        
        // Calculate total value (this would need to be fetched from server)
        const totalValue = selectedAssets.length * 1000; // Placeholder
        
        summaryContainer.innerHTML = `
            <div class="summary-row">
                <span>Selected Assets:</span>
                <span>${selectedAssets.length}</span>
            </div>
            <div class="summary-row">
                <span>Estimated Total Value:</span>
                <span>$${totalValue.toLocaleString()}</span>
            </div>
        `;
    }
    
    // Filter assets
    function filterAssets() {
        loadAssets(1);
    }
    
    // Clear filters
    function clearFilters() {
        document.getElementById('asset-filter-form').reset();
        loadAssets(1);
    }
    
    // Step navigation
    function nextStep() {
        const currentStep = getCurrentStep();
        const nextStepNum = currentStep + 1;
        
        if (currentStep === 1) {
            if (selectedAssets.length === 0) {
                alert('Please select at least one asset to continue.');
                return;
            }
        } else if (currentStep === 2) {
            if (!validateDisposalForm()) {
                return;
            }
            updateReviewDetails();
        }
        
        showStep(nextStepNum);
    }
    
    function prevStep() {
        const currentStep = getCurrentStep();
        const prevStepNum = currentStep - 1;
        showStep(prevStepNum);
    }
    
    function getCurrentStep() {
        const activeStep = document.querySelector('.step.active');
        return parseInt(activeStep.getAttribute('data-step'));
    }
    
    function showStep(stepNum) {
        // Update step indicator
        document.querySelectorAll('.step').forEach(step => {
            step.classList.remove('active', 'completed');
        });
        
        for (let i = 1; i <= stepNum; i++) {
            const step = document.querySelector(`[data-step="${i}"]`);
            if (i < stepNum) {
                step.classList.add('completed');
            } else {
                step.classList.add('active');
            }
        }
        
        // Show step content
        document.querySelectorAll('.step-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`step-${stepNum}`).classList.add('active');
    }
    
    // Validate disposal form
    function validateDisposalForm() {
        const requiredFields = ['disposal_type', 'disposal_date', 'asset_account', 'disposal_account', 'reason'];
        
        for (const fieldName of requiredFields) {
            const field = document.getElementById(fieldName);
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                alert(`Please fill in the ${fieldName.replace('_', ' ')} field.`);
                return false;
            } else {
                field.classList.remove('is-invalid');
            }
        }
        
        return true;
    }
    
    // Update review details
    function updateReviewDetails() {
        const reviewContainer = document.getElementById('review-details');
        const formData = new FormData(document.getElementById('bulk-disposal-form'));
        
        reviewContainer.innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Disposal Type:</strong> ${document.getElementById('disposal_type').options[document.getElementById('disposal_type').selectedIndex].text}</p>
                    <p><strong>Disposal Date:</strong> ${formData.get('disposal_date')}</p>
                    <p><strong>Asset Account:</strong> ${document.getElementById('asset_account').options[document.getElementById('asset_account').selectedIndex].text}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Disposal Account:</strong> ${document.getElementById('disposal_account').options[document.getElementById('disposal_account').selectedIndex].text}</p>
                    <p><strong>Reason:</strong> ${formData.get('reason')}</p>
                    <p><strong>Remarks:</strong> ${formData.get('remarks') || 'None'}</p>
                </div>
            </div>
        `;
        
        // Update final summary
        const finalSummaryContainer = document.getElementById('final-summary');
        finalSummaryContainer.innerHTML = `
            <div class="summary-row">
                <span>Total Assets:</span>
                <span>${selectedAssets.length}</span>
            </div>
            <div class="summary-row">
                <span>Request Type:</span>
                <span>Bulk Disposal</span>
            </div>
            <div class="summary-row">
                <span>Status:</span>
                <span>Pending Approval</span>
            </div>
        `;
    }
    
    // Submit bulk disposal
    function submitBulkDisposal() {
        if (selectedAssets.length === 0) {
            alert('No assets selected for disposal.');
            return;
        }
        
        const formData = new FormData(document.getElementById('bulk-disposal-form'));
        formData.append('selected_assets', JSON.stringify(selectedAssets));
        
        fetch('{% url "dispose_asset:bulk_disposal" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Bulk disposal request submitted successfully!');
                window.location.href = '{% url "dispose_asset:disposal_list" %}';
            } else {
                alert('Error submitting bulk disposal request: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error submitting bulk disposal request. Please try again.');
        });
    }
</script>
{% endblock %} 