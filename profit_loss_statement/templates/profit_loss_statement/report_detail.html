{% extends 'base.html' %}
{% load static %}

{% block title %}Profit & Loss Report Details - logisEdge{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profit_loss_statement/profit_loss_statement.css' %}">
<style>
    .report-header {
        border-bottom: 2px solid #007bff;
        padding-bottom: 1rem;
        margin-bottom: 2rem;
    }
    .financial-section {
        margin-bottom: 2rem;
    }
    .section-title {
        background-color: #f8f9fa;
        padding: 0.75rem 1rem;
        border-left: 4px solid #007bff;
        font-weight: 600;
        margin-bottom: 1rem;
    }
    .financial-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        border-bottom: 1px solid #e9ecef;
    }
    .financial-item:last-child {
        border-bottom: none;
    }
    .total-row {
        background-color: #f8f9fa;
        font-weight: 600;
        border-top: 2px solid #007bff;
    }
    .net-income {
        background-color: #e8f5e8;
        font-weight: 700;
        font-size: 1.1rem;
        border: 2px solid #28a745;
    }
    .amount {
        font-family: 'Courier New', monospace;
        text-align: right;
    }
    .positive {
        color: #28a745;
    }
    .negative {
        color: #dc3545;
    }
    @media print {
        .no-print {
            display: none !important;
        }
        .card {
            border: none;
            box-shadow: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4 no-print">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0 text-primary">
                        <i class="bi bi-graph-up-arrow me-2"></i>
                        Profit & Loss Report Details
                    </h1>
                    <p class="text-muted mb-0">Detailed view of saved profit and loss report</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{% url 'profit_loss_statement:report_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>Back to List
                    </a>
                    <button onclick="window.print()" class="btn btn-outline-primary">
                        <i class="bi bi-printer me-1"></i>Print
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-success dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-download me-1"></i>Export
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                            <li><a class="dropdown-item" href="{% url 'profit_loss_statement:export_profit_loss' %}?report_id={{ report.id }}&format=excel">
                                <i class="bi bi-file-earmark-excel me-2"></i>Excel (.xlsx)
                            </a></li>
                            <li><a class="dropdown-item" href="{% url 'profit_loss_statement:export_profit_loss' %}?report_id={{ report.id }}&format=pdf">
                                <i class="bi bi-file-earmark-pdf me-2"></i>PDF
                            </a></li>
                            <li><a class="dropdown-item" href="{% url 'profit_loss_statement:export_profit_loss' %}?report_id={{ report.id }}&format=csv">
                                <i class="bi bi-file-earmark-text me-2"></i>CSV
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Content -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-body">
                    <!-- Report Header -->
                    <div class="report-header text-center">
                        <h2 class="mb-1">{{ report.company.name|default:"Company Name" }}</h2>
                        <h3 class="text-primary mb-2">PROFIT & LOSS STATEMENT</h3>
                        <p class="mb-0">
                            <strong>Period:</strong> {{ report.from_date|date:"F d, Y" }} to {{ report.to_date|date:"F d, Y" }}
                        </p>
                        <p class="mb-0">
                            <strong>Generated:</strong> {{ report.created_at|date:"F d, Y H:i" }}
                        </p>
                    </div>

                    <!-- Revenue Section -->
                    <div class="financial-section">
                        <div class="section-title">
                            <i class="bi bi-arrow-up-circle me-2"></i>REVENUE
                        </div>
                        {% if report.revenue_data %}
                            {% for item in report.revenue_data %}
                            <div class="financial-item">
                                <span>{{ item.name }}</span>
                                <span class="amount positive">${{ item.amount|floatformat:2 }}</span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="financial-item">
                                <span>Sales Revenue</span>
                                <span class="amount positive">${{ report.total_revenue|default:0|floatformat:2 }}</span>
                            </div>
                        {% endif %}
                        <div class="financial-item total-row">
                            <span><strong>Total Revenue</strong></span>
                            <span class="amount positive"><strong>${{ report.total_revenue|default:0|floatformat:2 }}</strong></span>
                        </div>
                    </div>

                    <!-- Cost of Goods Sold -->
                    {% if report.cogs_data or report.total_cogs %}
                    <div class="financial-section">
                        <div class="section-title">
                            <i class="bi bi-box me-2"></i>COST OF GOODS SOLD
                        </div>
                        {% if report.cogs_data %}
                            {% for item in report.cogs_data %}
                            <div class="financial-item">
                                <span>{{ item.name }}</span>
                                <span class="amount negative">${{ item.amount|floatformat:2 }}</span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="financial-item">
                                <span>Cost of Goods Sold</span>
                                <span class="amount negative">${{ report.total_cogs|default:0|floatformat:2 }}</span>
                            </div>
                        {% endif %}
                        <div class="financial-item total-row">
                            <span><strong>Total Cost of Goods Sold</strong></span>
                            <span class="amount negative"><strong>${{ report.total_cogs|default:0|floatformat:2 }}</strong></span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Gross Profit -->
                    <div class="financial-section">
                        <div class="financial-item total-row">
                            <span><strong>GROSS PROFIT</strong></span>
                            <span class="amount {% if report.gross_profit >= 0 %}positive{% else %}negative{% endif %}">
                                <strong>${{ report.gross_profit|default:0|floatformat:2 }}</strong>
                            </span>
                        </div>
                    </div>

                    <!-- Operating Expenses -->
                    <div class="financial-section">
                        <div class="section-title">
                            <i class="bi bi-arrow-down-circle me-2"></i>OPERATING EXPENSES
                        </div>
                        {% if report.expense_data %}
                            {% for item in report.expense_data %}
                            <div class="financial-item">
                                <span>{{ item.name }}</span>
                                <span class="amount negative">${{ item.amount|floatformat:2 }}</span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="financial-item">
                                <span>Operating Expenses</span>
                                <span class="amount negative">${{ report.total_expenses|default:0|floatformat:2 }}</span>
                            </div>
                        {% endif %}
                        <div class="financial-item total-row">
                            <span><strong>Total Operating Expenses</strong></span>
                            <span class="amount negative"><strong>${{ report.total_expenses|default:0|floatformat:2 }}</strong></span>
                        </div>
                    </div>

                    <!-- Other Income -->
                    {% if report.other_income_data or report.total_other_income %}
                    <div class="financial-section">
                        <div class="section-title">
                            <i class="bi bi-plus-circle me-2"></i>OTHER INCOME
                        </div>
                        {% if report.other_income_data %}
                            {% for item in report.other_income_data %}
                            <div class="financial-item">
                                <span>{{ item.name }}</span>
                                <span class="amount positive">${{ item.amount|floatformat:2 }}</span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="financial-item">
                                <span>Other Income</span>
                                <span class="amount positive">${{ report.total_other_income|default:0|floatformat:2 }}</span>
                            </div>
                        {% endif %}
                        <div class="financial-item total-row">
                            <span><strong>Total Other Income</strong></span>
                            <span class="amount positive"><strong>${{ report.total_other_income|default:0|floatformat:2 }}</strong></span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Other Expenses -->
                    {% if report.other_expense_data or report.total_other_expenses %}
                    <div class="financial-section">
                        <div class="section-title">
                            <i class="bi bi-dash-circle me-2"></i>OTHER EXPENSES
                        </div>
                        {% if report.other_expense_data %}
                            {% for item in report.other_expense_data %}
                            <div class="financial-item">
                                <span>{{ item.name }}</span>
                                <span class="amount negative">${{ item.amount|floatformat:2 }}</span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="financial-item">
                                <span>Other Expenses</span>
                                <span class="amount negative">${{ report.total_other_expenses|default:0|floatformat:2 }}</span>
                            </div>
                        {% endif %}
                        <div class="financial-item total-row">
                            <span><strong>Total Other Expenses</strong></span>
                            <span class="amount negative"><strong>${{ report.total_other_expenses|default:0|floatformat:2 }}</strong></span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Net Income -->
                    <div class="financial-section">
                        <div class="financial-item net-income">
                            <span><strong>NET INCOME</strong></span>
                            <span class="amount {% if report.net_income >= 0 %}positive{% else %}negative{% endif %}">
                                <strong>${{ report.net_income|default:0|floatformat:2 }}</strong>
                            </span>
                        </div>
                    </div>

                    <!-- Report Footer -->
                    <div class="mt-4 pt-3 border-top text-center text-muted">
                        <small>
                            This report was generated on {{ report.created_at|date:"F d, Y \a\t H:i" }} by logisEdge Financial Management System
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add any additional JavaScript functionality here
document.addEventListener('DOMContentLoaded', function() {
    // Print functionality
    const printBtn = document.querySelector('[onclick="window.print()"]');
    if (printBtn) {
        printBtn.addEventListener('click', function(e) {
            e.preventDefault();
            window.print();
        });
    }
});
</script>
{% endblock %}