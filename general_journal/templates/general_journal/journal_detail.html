{% extends 'base.html' %}
{% load static %}

{% block title %}Journal Entry Detail - {{ journal_entry.journal_number }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/general_journal/general_journal.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="journal-detail-container">
                <div class="journal-detail-header">
                    <h3>
                        <i class="bi bi-journal-text me-2"></i>
                        Journal Entry Detail
                    </h3>
                    <div class="journal-actions">
                        {% if journal_entry.status == 'draft' %}
                            <a href="{% url 'general_journal:journal_update' journal_entry.pk %}" class="action-btn action-btn-primary">
                                <i class="bi bi-pencil me-1"></i>Edit
                            </a>
                            <a href="{% url 'general_journal:journal_post' journal_entry.pk %}" class="action-btn action-btn-success">
                                <i class="bi bi-check-circle me-1"></i>Post
                            </a>
                            <a href="{% url 'general_journal:journal_cancel' journal_entry.pk %}" class="action-btn action-btn-warning">
                                <i class="bi bi-x-circle me-1"></i>Cancel
                            </a>
                            <a href="{% url 'general_journal:journal_delete' journal_entry.pk %}" class="action-btn action-btn-danger">
                                <i class="bi bi-trash me-1"></i>Delete
                            </a>
                        {% endif %}
                        <a href="{% url 'general_journal:journal_print' journal_entry.pk %}" class="action-btn action-btn-info" target="_blank">
                            <i class="bi bi-printer me-1"></i>Print
                        </a>
                        <a href="{% url 'general_journal:journal_list' %}" class="action-btn action-btn-secondary">
                            <i class="bi bi-arrow-left me-1"></i>Back to List
                        </a>
                    </div>
                </div>
                
                <div class="journal-detail-body">
                    <!-- Journal Entry Information -->
                    <div class="journal-info-grid">
                        <div class="journal-info-section">
                            <h5>Basic Information</h5>
                            <div class="info-row">
                                <span class="info-label">Journal Number:</span>
                                <span class="info-value">{{ journal_entry.journal_number }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Date:</span>
                                <span class="info-value">{{ journal_entry.date|date:"F d, Y" }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Reference:</span>
                                <span class="info-value">{{ journal_entry.reference|default:"No reference" }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">
                                    {% if journal_entry.status == 'draft' %}
                                        <span class="status-badge status-draft">Draft</span>
                                    {% elif journal_entry.status == 'posted' %}
                                        <span class="status-badge status-posted">Posted</span>
                                    {% elif journal_entry.status == 'cancelled' %}
                                        <span class="status-badge status-cancelled">Cancelled</span>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="journal-info-section">
                            <h5>Financial Information</h5>
                            <div class="info-row">
                                <span class="info-label">Total Debit:</span>
                                <span class="info-value text-danger fw-bold">AED {{ journal_entry.total_debit|floatformat:2 }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Total Credit:</span>
                                <span class="info-value text-success fw-bold">AED {{ journal_entry.total_credit|floatformat:2 }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Balance:</span>
                                <span class="info-value">
                                    {% if journal_entry.is_balanced %}
                                        <span class="balance-indicator balanced">BALANCED</span>
                                    {% else %}
                                        <span class="balance-indicator unbalanced">
                                            UNBALANCED ({{ journal_entry.total_debit|add:journal_entry.total_credit|floatformat:2 }})
                                        </span>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="journal-info-section">
                            <h5>Additional Information</h5>
                            <div class="info-row">
                                <span class="info-label">Company:</span>
                                <span class="info-value">{{ journal_entry.company.company_name }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Fiscal Year:</span>
                                <span class="info-value">{{ journal_entry.fiscal_year.name }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Created By:</span>
                                <span class="info-value">{{ journal_entry.created_by.get_full_name|default:journal_entry.created_by.username }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Created On:</span>
                                <span class="info-value">{{ journal_entry.created_at|date:"F d, Y H:i" }}</span>
                            </div>
                            {% if journal_entry.posted_by %}
                            <div class="info-row">
                                <span class="info-label">Posted By:</span>
                                <span class="info-value">{{ journal_entry.posted_by.get_full_name|default:journal_entry.posted_by.username }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Posted On:</span>
                                <span class="info-value">{{ journal_entry.posted_at|date:"F d, Y H:i" }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Description -->
                    {% if journal_entry.description %}
                    <div class="journal-info-section">
                        <h5>Description</h5>
                        <p>{{ journal_entry.description|linebreaks }}</p>
                    </div>
                    {% endif %}
                    
                    <!-- Journal Entry Lines -->
                    <div class="journal-info-section">
                        <h5>Journal Entry Lines</h5>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Account</th>
                                        <th>Description</th>
                                        <th class="text-end">Debit Amount</th>
                                        <th class="text-end">Credit Amount</th>
                                        <th>Reference</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for line in journal_entry.lines.all %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>
                                            <div>
                                                <strong>{{ line.account.name }}</strong>
                                                <br>
                                                <small class="text-muted">
                                                    {{ line.account.account_code }} - {{ line.account.account_type.name }}
                                                </small>
                                            </div>
                                        </td>
                                        <td>{{ line.description|default:"-" }}</td>
                                        <td class="text-end">
                                            {% if line.debit_amount > 0 %}
                                                <span class="text-danger fw-bold">AED {{ line.debit_amount|floatformat:2 }}</span>
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            {% if line.credit_amount > 0 %}
                                                <span class="text-success fw-bold">AED {{ line.credit_amount|floatformat:2 }}</span>
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                        <td>{{ line.reference|default:"-" }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tfoot>
                                    <tr class="table-light">
                                        <td colspan="3" class="text-end"><strong>Totals:</strong></td>
                                        <td class="text-end">
                                            <strong class="text-danger">AED {{ journal_entry.total_debit|floatformat:2 }}</strong>
                                        </td>
                                        <td class="text-end">
                                            <strong class="text-success">AED {{ journal_entry.total_credit|floatformat:2 }}</strong>
                                        </td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Notes -->
                    {% if journal_entry.notes %}
                    <div class="journal-info-section">
                        <h5>Notes</h5>
                        <div class="alert alert-info">
                            {{ journal_entry.notes|linebreaks }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/general_journal/general_journal.js' %}"></script>
{% endblock %}